<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Whitelist Inserter</title>
    <style>
        /* Genel Stil ve Koyu Tema Ayarları */
        body {
            font-family: 'Inter', sans-serif; /* Modern bir font */
            margin: 0;
            padding: 20px;
            background-color: #22272e; /* GitHub koyu tema arka planı */
            color: #adbac7; /* Açık gri metin rengi */
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh; /* Tam ekran yüksekliği */
            box-sizing: border-box; /* Padding'i kutu modeline dahil et */
        }

        h1 {
            color: #c9d1d9; /* Başlık için biraz daha açık renk */
            margin-bottom: 35px;
            font-size: 2.5em;
            letter-spacing: 1.5px;
            text-shadow: 0 2px 5px rgba(0,0,0,0.3);
            text-align: center;
        }

        /* Ana Konteyner */
        .container {
            width: 90%;
            max-width: 950px; /* Biraz daha geniş */
            background-color: #2d333b; /* Konteyner arka planı */
            padding: 30px;
            border-radius: 12px; /* Daha yuvarlak köşeler */
            box-shadow: 0 8px 20px rgba(0,0,0,0.3); /* Daha belirgin gölge */
            margin-bottom: 40px;
            border: 1px solid #444c56; /* Hafif kenarlık */
        }

        /* Bilgi Notları */
        .info-notes {
            margin-bottom: 25px;
            padding-bottom: 25px;
            border-bottom: 1px solid #444c56; /* Koyu temaya uygun çizgi */
        }
        .info-notes p {
            font-size: 0.95em;
            line-height: 1.6;
            margin-bottom: 10px;
        }
        .info-notes p:last-child {
            margin-bottom: 0;
        }
        .info-notes .red-note {
            color: #f85149; /* Kırmızı uyarı */
            font-weight: bold;
        }
        .info-notes .orange-note {
            color: #e3b341; /* Turuncu uyarı */
        }

        /* Her Bir Alan Satırı */
        .item-row {
            display: flex;
            align-items: flex-start; /* Checkbox ve label hizalaması */
            margin-bottom: 10px;
            padding-bottom: 10px;
            border-bottom: 2px solid #4d94ff; /* Daha ince ve koyu çizgi */
        }
        .item-row:last-of-type { /* Son item-row için border'ı kaldır */
            border-bottom: none;
            margin-bottom: 0;
            padding-bottom: 0;
        }

        /* Checkbox Konteyneri */
        .checkbox-container {
            margin-right: 20px;
            padding-top: 20px; /* Checkbox'ı dikeyde ortala */
            flex-shrink: 0; /* Küçülmesini engelle */
        }
        .checkbox-container input[type="checkbox"] {
            transform: scale(2); /* Biraz daha büyük */
            accent-color: #3895ff; /* GitHub mavisi */
            margin-top: 0;
            cursor: pointer;
        }

        /* Kolon Etiket Grubu */
        .column-label-group {
            display: flex;
            flex-direction: column;
            align-items: flex-start;
            min-width: 190px; /* Biraz daha geniş */
            margin-right: 20px;
            flex-shrink: 0; /* Küçülmesini engelle */
        }
        .column-name {
            font-weight: 600; /* Daha belirgin */
            color: #c9d1d9;
            font-size: 1.15em;
            margin-bottom: 5px;
        }
        .column-description {
            font-size: 0.85em;
            color: #8b949e; /* Daha soluk gri */
            font-style: normal; /* İtalik olmasın */
        }

        /* Metin Alanı Konteyneri */
        .text-area-container {
            flex-grow: 1;
            display: flex;
            align-items: center;
        }
        textarea {
            width: 100%;
            min-height: 80px; /* Biraz daha uzun */
            padding: 12px;
            border: 2px solid #444c56; /* Koyu temaya uygun kenarlık */
            border-radius: 8px; /* Daha yuvarlak */
            box-sizing: border-box;
            resize: vertical;
            font-size: 1em;
            line-height: 1.6;
            background-color: #1c2128; /* Koyu input arka planı */
            color: #adbac7; /* Metin rengi */
            box-shadow: inset 0 1px 3px rgba(0,0,0,0.2);
            transition: border-color 0.2s ease, box-shadow 0.2s ease;
        }
        textarea::placeholder {
            color: #6e7681; /* Placeholder rengi */
        }
        textarea:focus {
            outline: none;
            border-color: #58a6ff; /* Odaklandığında GitHub mavisi */
            box-shadow: 0 0 0 2px rgba(88,166,255,0.3); /* Hafif parlama */
        }

        /* "Şimdiki Zaman" ve "İlk Satırı Tekrarla" Checkbox'ları */
        .now-time-checkbox, .repeat-first-checkbox {
            margin-left: 25px;
            display: flex;
            align-items: center;
            white-space: nowrap;
            flex-shrink: 0;
        }
        .now-time-checkbox label, .repeat-first-checkbox label {
            display: flex;
            align-items: center;
            gap: 10px;
            cursor: pointer;
        }
        .now-time-checkbox input[type="checkbox"], .repeat-first-checkbox input[type="checkbox"] {
            transform: scale(1.4);
            accent-color: #f85149; /* Kırmızı renk */
        }
        .now-time-checkbox span, .repeat-first-checkbox span {
            font-size: 0.95em;
            color: #adbac7;
        }

        /* Buton Stili */
        .create-button {
            padding: 16px 35px;
            font-size: 1.2em;
            font-weight: 600;
            background-color: #58a6ff; /* GitHub yeşili */
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: background-color 0.3s ease, transform 0.2s ease, box-shadow 0.2s ease;
            box-shadow: 0 4px 10px #2b517e;
            margin-top: 20px; /* Buton ile konteyner arasına boşluk */
        }
        .create-button:hover {
            background-color: #a1cdff; /* Hover rengi */
            transform: translateY(-3px);
            box-shadow: 0 6px 6px #63acff; /* Hover'da daha belirgin gölge */
        }
        .create-button:active {
            transform: translateY(0);
            background-color: #63acff; /* Active rengi */
            box-shadow: inset 0 2px 4px rgba(0,0,0,0.3);
        }

        /* SQL Çıktısı Alanı */
        #sqlOutputContainer {
            margin-top: 40px;
            width: 90%;
            max-width: 950px;
            background-color: #1c2128; /* Koyu kod alanı arka planı */
            color: #c9d1d9; /* Kod metin rengi */
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 8px 20px rgba(0,0,0,0.3);
            font-family: 'Fira Code', 'Consolas', 'Monaco', monospace; /* Kod fontu */
            font-size: 0.9em;
            white-space: pre-wrap; /* Bu özellik artık #sqlOutput üzerinde */
            word-break: break-all; /* Uzun kelimeleri böler */
            position: relative;
            border: 1px solid #444c56;
            min-height: 120px; /* Minimum yükseklik */
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
        }
        #sqlOutput {
            /* overflow-x: auto; /* Yatay kaydırma çubuğu - KALDIRILDI */
            max-height: 250px; /* Maksimum yükseklik */
            padding-top: 10px; /* Kopyala butonu için boşluk */
            width: 100%; /* İçeriğin genişliği */
            box-sizing: border-box;
            color: #8b949e; /* Placeholder metin rengi */
            font-style: italic;
            white-space: pre-wrap; /* Uzun satırları otomatik sarar */
            overflow-wrap: break-word; /* Uzun kelimeleri satır sonlarında kırar */
            text-align: left; /* Output should be left-aligned for SQL */
            padding-left: 10px; /* Indent for readability */
        }

        /* Kopyala Butonu */
        #copySqlBtn {
            position: absolute;
            top: 15px;
            right: 20px;
            background-color: #444c56; /* Koyu gri buton */
            color: #c9d1d9;
            border: none;
            border-radius: 6px;
            padding: 8px 16px;
            font-size: 0.9em;
            cursor: pointer;
            z-index: 2;
            transition: background-color 0.2s, transform 0.1s;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }
        #copySqlBtn:hover {
            background-color: #586069;
            transform: translateY(-1px);
        }
        #copySqlBtn:active {
            transform: translateY(0);
            background-color: #3b424d;
            box-shadow: inset 0 1px 3px rgba(0,0,0,0.3);
        }

        /* Responsive Tasarım */
        @media (max-width: 768px) {
            .container, #sqlOutputContainer {
                width: 95%;
                padding: 20px;
            }
            h1 {
                font-size: 2em;
                margin-bottom: 25px;
            }
            .item-row {
                flex-direction: column;
                align-items: stretch;
            }
            .checkbox-container, .column-label-group, 
            .now-time-checkbox, .repeat-first-checkbox {
                margin-right: 0;
                margin-bottom: 10px;
                width: 100%;
            }
            .column-label-group {
                min-width: unset;
            }
            .text-area-container {
                margin-bottom: 15px;
            }
            .now-time-checkbox, .repeat-first-checkbox {
                margin-left: 0;
                justify-content: flex-start;
            }
            .create-button {
                width: 100%;
                padding: 14px 20px;
                font-size: 1.1em;
            }
            #copySqlBtn {
                position: static; /* Mobil görünümde statik konuma al */
                width: 100%;
                margin-top: 15px;
                margin-bottom: 10px;
                text-align: center;
            }
            #sqlOutput {
                max-height: 180px;
            }
        }
    </style>
</head>
<body>

    <h1>Whitelist Inserter</h1>

    <div class="container">
        <div class="info-notes">
            <p class="red-note">Not: Excel'den kopyalanan her satır, sistem tarafından ayrı bir INSERT komutu olarak işlenir. Lütfen verileri satır satır yapıştırınız ve tüm satırların aynı sayıda veri içerdiğinden emin olunuz.</p>
            <p class="orange-note">created_at, created_by_id, park_id, description gibi sabit alanlar tek bir satır olarak girilebilir; bu değerler, diğer tüm verilerle birlikte otomatik olarak her INSERT komutuna dahil edilecektir.</p>
        </div>
        
        <div class="item-row">
            <div class="checkbox-container">
                <input type="checkbox" id="created_at_check">
            </div>
            <div class="column-label-group">
                <div class="column-name">created_at</div>
                <div class="column-description"></div>
            </div>
            <div class="text-area-container">
                <textarea id="created_at_text" placeholder="YYYY-MM-DD HH:MM:SS formatında giriniz..."></textarea>
            </div>
            <div class="now-time-checkbox">
                <label>
                    <input type="checkbox" id="created_at_now_check">
                    <span>Şimdiki Zaman</span>
                </label>
            </div>
        </div>

        <div class="item-row">
            <div class="checkbox-container">
                <input type="checkbox" id="created_by_id_check">
            </div>
            <div class="column-label-group">
                <div class="column-name">created_by_id</div>
                <div class="column-description">(Oluşturan kişi ID)</div>
            </div>
            <div class="text-area-container">
                <textarea id="created_by_id_text" placeholder="Örn: 10675"></textarea>
            </div>
            <div class="repeat-first-checkbox">
                <label>
                    <input type="checkbox" id="created_by_id_repeat_check" checked>
                    <span>İlk Satırı Tekrarla</span>
                </label>
            </div>
        </div>

        <div class="item-row">
            <div class="checkbox-container">
                <input type="checkbox" id="updated_at_check">
            </div>
            <div class="column-label-group">
                <div class="column-name">updated_at</div>
                <div class="column-description"></div>
            </div>
            <div class="text-area-container">
                <textarea id="updated_at_text" placeholder="YYYY-MM-DD HH:MM:SS formatında giriniz..."></textarea>
            </div>
            <div class="now-time-checkbox">
                <label>
                    <input type="checkbox" id="updated_at_now_check">
                    <span>Şimdiki Zaman</span>
                </label>
            </div>
        </div>

        <div class="item-row">
            <div class="checkbox-container">
                <input type="checkbox" id="updated_by_id_check">
            </div>
            <div class="column-label-group">
                <div class="column-name">updated_by_id</div>
                <div class="column-description">(Güncelleyen kişi ID)</div>
            </div>
            <div class="text-area-container">
                <textarea id="updated_by_id_text" placeholder="Örn: 10675"></textarea>
            </div>
            <div class="repeat-first-checkbox">
                <label>
                    <input type="checkbox" id="updated_by_id_repeat_check" checked>
                    <span>İlk Satırı Tekrarla</span>
                </label>
            </div>
        </div>
        
        <div class="item-row">
            <div class="checkbox-container">
                <input type="checkbox" id="plate_check">
            </div>
            <div class="column-label-group">
                <div class="column-name">plate</div>
                <div class="column-description">(Plaka)</div>
            </div>
            <div class="text-area-container">
                <textarea id="plate_text" placeholder="Örn: 34GTY132"></textarea>
            </div>
            </div>

        <div class="item-row">
            <div class="checkbox-container">
                <input type="checkbox" id="park_id_check">
            </div>
            <div class="column-label-group">
                <div class="column-name">park_id</div>
                <div class="column-description">(Parkın ID'si)</div>
            </div>
            <div class="text-area-container">
                <textarea id="park_id_text" placeholder="Örn: 77"></textarea>
            </div>
            <div class="repeat-first-checkbox">
                <label>
                    <input type="checkbox" id="park_id_repeat_check" checked>
                    <span>İlk Satırı Tekrarla</span>
                </label>
            </div>
        </div>

        <div class="item-row">
            <div class="checkbox-container">
                <input type="checkbox" id="description_check">
            </div>
            <div class="column-label-group">
                <div class="column-name">description</div>
                <div class="column-description">(Açıklama)</div>
            </div>
            <div class="text-area-container">
                <textarea id="description_text" placeholder="Örn: Malik"></textarea>
            </div>
            <div class="repeat-first-checkbox">
                <label>
                    <input type="checkbox" id="description_repeat_check" checked>
                    <span>İlk Satırı Tekrarla</span>
                </label>
            </div>
        </div>

        <div class="item-row">
            <div class="checkbox-container">
                <input type="checkbox" id="expiry_at_check">
            </div>
            <div class="column-label-group">
                <div class="column-name">expiry_at</div>
                <div class="column-description">(Geçerlilik Tarihi)</div>
            </div>
            <div class="text-area-container">
                <textarea id="expiry_at_text" placeholder="YYYY-MM-DD HH:MM:SS formatında giriniz..."></textarea>
            </div>
            <div class="now-time-checkbox">
                <label>
                    <input type="checkbox" id="expiry_at_now_check">
                    <span>Şimdiki Zaman</span>
                </label>
            </div>
        </div>

        <div class="item-row">
            <div class="checkbox-container">
                <input type="checkbox" id="payment_status_check">
            </div>
            <div class="column-label-group">
                <div class="column-name">payment_status</div>
                <div class="column-description">(Ödeme Durumu)</div>
            </div>
            <div class="text-area-container">
                <textarea id="payment_status_text" placeholder="Örn: Ödendi"></textarea>
            </div>
            <div class="repeat-first-checkbox">
                <label>
                    <input type="checkbox" id="payment_status_repeat_check" checked>
                    <span>İlk Satırı Tekrarla</span>
                </label>
            </div>
        </div>

        <div class="item-row">
            <div class="checkbox-container">
                <input type="checkbox" id="phone_check">
            </div>
            <div class="column-label-group">
                <div class="column-name">phone</div>
                <div class="column-description">(Telefon Numarası)</div>
            </div>
            <div class="text-area-container">
                <textarea id="phone_text" placeholder="Örn: 5551234567"></textarea>
            </div>
            <div class="repeat-first-checkbox">
                <label>
                    <input type="checkbox" id="phone_repeat_check" checked>
                    <span>İlk Satırı Tekrarla</span>
                </label>
            </div>
        </div>

        <div class="item-row">
            <div class="checkbox-container">
                <input type="checkbox" id="payment_amount_check">
            </div>
            <div class="column-label-group">
                <div class="column-name">payment_amount</div>
                <div class="column-description">(Ödeme Miktarı)</div>
            </div>
            <div class="text-area-container">
                <textarea id="payment_amount_text" placeholder="Örn: 15.75"></textarea>
            </div>
            <div class="repeat-first-checkbox">
                <label>
                    <input type="checkbox" id="payment_amount_repeat_check" checked>
                    <span>İlk Satırı Tekrarla</span>
                </label>
            </div>
        </div>

        <div class="item-row">
            <div class="checkbox-container">
                <input type="checkbox" id="name_check">
            </div>
            <div class="column-label-group">
                <div class="column-name">name</div>
                <div class="column-description">(Müşteri Adı)</div>
            </div>
            <div class="text-area-container">
                <textarea id="name_text" placeholder="Örn: EMRE"></textarea>
            </div>
            <div class="repeat-first-checkbox">
                <label>
                    <input type="checkbox" id="name_repeat_check" checked>
                    <span>İlk Satırı Tekrarla</span>
                </label>
            </div>
        </div>

        <div class="item-row">
            <div class="checkbox-container">
                <input type="checkbox" id="company_check">
            </div>
            <div class="column-label-group">
                <div class="column-name">company</div>
                <div class="column-description">(Şirket)</div>
            </div>
            <div class="text-area-container">
                <textarea id="company_text" placeholder="Örn: A.Ş."></textarea>
            </div>
            <div class="repeat-first-checkbox">
                <label>
                    <input type="checkbox" id="company_repeat_check" checked>
                    <span>İlk Satırı Tekrarla</span>
                </label>
            </div>
        </div>

        <div class="item-row">
            <div class="checkbox-container">
                <input type="checkbox" id="company_name_check">
            </div>
            <div class="column-label-group">
                <div class="column-name">company_name</div>
                <div class="column-description">(Şirket Adı)</div>
            </div>
            <div class="text-area-container">
                <textarea id="company_name_text" placeholder="Örn: 4B PLAZA"></textarea>
            </div>
            <div class="repeat-first-checkbox">
                <label>
                    <input type="checkbox" id="company_name_repeat_check" checked>
                    <span>İlk Satırı Tekrarla</span>
                </label>
            </div>
        </div>

    </div>

    <button class="create-button" id="createButton">SQL Sorgusu Oluştur</button>

    <div id="sqlOutputContainer">
        <button id="copySqlBtn" title="Kopyala">Kopyala</button>
        <pre id="sqlOutput">Veri giriniz.</pre>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const createButton = document.getElementById('createButton');
            const sqlOutput = document.getElementById('sqlOutput');
            const copySqlBtn = document.getElementById('copySqlBtn');

            if (copySqlBtn) {
                copySqlBtn.addEventListener('click', () => {
                    const sql = sqlOutput.textContent;
                    // Check if the output is not the initial placeholder
                    if (sql && sql.trim() !== "" && sql !== "Veri giriniz." && sql !== "Lütfen oluşturmak için en az bir alan seçin veya doldurun." && sql !== "Hiç geçerli alan seçilmedi veya doldurulmadı.") {
                        navigator.clipboard.writeText(sql).then(() => {
                            copySqlBtn.textContent = "Kopyalandı!";
                            setTimeout(() => { copySqlBtn.textContent = "Kopyala"; }, 1200);
                        }).catch(err => {
                            console.error('Kopyalama başarısız:', err);
                        });
                    }
                });
            }

            const fieldsConfig = {
                created_at: { checkboxId: 'created_at_check', textareaId: 'created_at_text', type: 'datetime', special: 'now_datetime', placeholder: 'YYYY-MM-DD HH:MM:SS formatında giriniz...' },
                created_by_id: { checkboxId: 'created_by_id_check', textareaId: 'created_by_id_text', type: 'int', hasRepeatOption: true, placeholder: 'Örn: 10675' },
                updated_at: { checkboxId: 'updated_at_check', textareaId: 'updated_at_text', type: 'datetime', special: 'now_datetime', placeholder: 'YYYY-MM-DD HH:MM:SS formatında giriniz...' },
                updated_by_id: { checkboxId: 'updated_by_id_check', textareaId: 'updated_by_id_text', type: 'int', hasRepeatOption: true, placeholder: 'Örn: 10675' },
                plate: { checkboxId: 'plate_check', textareaId: 'plate_text', type: 'varchar(255)', multiLine: true, placeholder: 'Örn: 34GTY132' },
                park_id: { checkboxId: 'park_id_check', textareaId: 'park_id_text', type: 'int', hasRepeatOption: true, placeholder: 'Örn: 77' },
                description: { checkboxId: 'description_check', textareaId: 'description_text', type: 'text', special: 'concat_malik', hasRepeatOption: true, placeholder: 'Örn: Malik' },
                expiry_at: { checkboxId: 'expiry_at_check', textareaId: 'expiry_at_text', type: 'datetime', special: 'now_datetime', placeholder: 'YYYY-MM-DD HH:MM:SS formatında giriniz...' },
                payment_status: { checkboxId: 'payment_status_check', textareaId: 'payment_status_text', type: 'int', hasRepeatOption: true, placeholder: 'Örn: 1' },
                phone: { checkboxId: 'phone_check', textareaId: 'phone_text', type: 'varchar(255)', hasRepeatOption: true, placeholder: 'Örn: 5551234567' },
                payment_amount: { checkboxId: 'payment_amount_check', textareaId: 'payment_amount_text', type: 'double(11,2)', hasRepeatOption: true, placeholder: 'Örn: 15.75' },
                name: { checkboxId: 'name_check', textareaId: 'name_text', type: 'varchar(255)', hasRepeatOption: true, placeholder: 'Örn: EMRE' },
                company: { checkboxId: 'company_check', textareaId: 'company_text', type: 'varchar(255)', hasRepeatOption: true, placeholder: 'Örn: A.Ş.' },
                company_name: { checkboxId: 'company_name_check', textareaId: 'company_name_text', type: 'varchar(255)', hasRepeatOption: true, placeholder: 'Örn: 4B PLAZA' }
            };

            // Apply input filters - This loop is now removed as per the request.
            // for (const fieldName in fieldsConfig) {
            //     const config = fieldsConfig[fieldName];
            //     if (config.inputFilter) {
            //         const textarea = document.getElementById(config.textareaId);
            //         if (textarea) {
            //             textarea.addEventListener('input', function() {
            //                 this.value = this.value.replace(config.inputFilter, '');
            //             });
            //         }
            //     }
            // }

            // Function to escape SQL string values
            function escapeSqlString(str) {
                if (typeof str !== 'string') {
                    return str; // Return as is if not a string (e.g., numbers, boolean)
                }
                return str.replace(/'/g, "''");
            }

            createButton.addEventListener('click', () => {
                let columnsSet = new Set();
                let allRowsData = [];
                let plateLinesCount = 0;

                // 1. Determine plateLinesCount (master row count)
                const plateTextarea = document.getElementById(fieldsConfig.plate.textareaId);
                const plateCheckbox = document.getElementById(fieldsConfig.plate.checkboxId);

                if (plateCheckbox && plateCheckbox.checked) {
                    const lines = plateTextarea.value.trim().split('\n').filter(line => line.trim() !== '');
                    plateLinesCount = lines.length > 0 ? lines.length : 1; // If checked but empty, still consider 1 row
                }

                // If no multi-line inputs, but fixed fields are selected/filled, ensure at least one row is generated
                let hasAnyCheckedField = false;
                for (const fieldName in fieldsConfig) {
                    const config = fieldsConfig[fieldName];
                    const checkbox = document.getElementById(config.checkboxId);
                    if (checkbox && checkbox.checked) {
                        hasAnyCheckedField = true;
                        break;
                    }
                }

                if (plateLinesCount === 0 && hasAnyCheckedField) {
                    plateLinesCount = 1; // If no plate data, but some field is checked, generate at least one row.
                } else if (plateLinesCount === 0 && !hasAnyCheckedField) {
                    sqlOutput.textContent = "Lütfen oluşturmak için en az bir alan seçin veya doldurun.";
                    sqlOutput.style.color = '#dc3545';
                    return;
                }
                
                // 2. Collect and process data for each row based on plateLinesCount
                for (let i = 0; i < plateLinesCount; i++) {
                    let currentRowValues = {}; // Store values for the current row
                    
                    for (const fieldName in fieldsConfig) {
                        const config = fieldsConfig[fieldName];
                        const checkbox = document.getElementById(config.checkboxId);
                        const textarea = document.getElementById(config.textareaId);
                        const repeatCheckbox = config.hasRepeatOption ? document.getElementById(fieldName + '_repeat_check') : null;
                        const nowCheckbox = config.special === 'now_datetime' ? document.getElementById(fieldName + '_now_check') : null;

                        let value = null; // Default value is NULL

                        // Only process if the main checkbox for the field is checked
                        if (checkbox && checkbox.checked) {
                            columnsSet.add(fieldName); // Add column to the global set of used columns

                            if (nowCheckbox && nowCheckbox.checked) {
                                value = 'NOW()';
                            } else if (textarea) {
                                let lines = textarea.value.split('\n').map(line => line.trim()); // No filter, just split and trim

                                if (fieldName === 'plate') { // Plate is multi-line and determines maxRows
                                    value = lines[i] !== undefined ? lines[i] : '';
                                } else if (config.hasRepeatOption && repeatCheckbox && repeatCheckbox.checked) {
                                    // If 'İlk Satırı Tekrarla' is checked, use the first line for all rows
                                    value = lines[0] !== undefined ? lines[0] : '';
                                } else {
                                    // For other multi-line fields or single-line fields without repeat option,
                                    // use the value corresponding to the current row index
                                    value = lines[i] !== undefined ? lines[i] : '';
                                }
                                
                                // Handle special cases like CONCAT for description
                                if (config.special === 'concat_malik') {
                                    const descText = value.trim();
                                    const malikPrefix = 'Malik';
                                    if (descText !== '') {
                                        value = `CONCAT('${escapeSqlString(descText)} - ', DATE_FORMAT(NOW(), '%Y-%m-%d'))`;
                                    } else {
                                        value = `CONCAT('${escapeSqlString(malikPrefix)} - ', DATE_FORMAT(NOW(), '%Y-%m-%d'))`;
                                    }
                                } else {
                                    // Format value based on type for SQL
                                    if (value === '') { // If the value is an empty string, set it to NULL
                                        value = 'NULL';
                                    } else if (config.type.startsWith('varchar') || config.type === 'text' || config.type === 'datetime') {
                                        value = `'${escapeSqlString(value)}'`;
                                    } else if (config.type.startsWith('int')) {
                                        value = parseInt(value, 10);
                                        if (isNaN(value)) value = 'NULL'; // If not a valid number, treat as NULL
                                    } else if (config.type.startsWith('double')) {
                                        value = parseFloat(value.replace(',', '.')); // Handle comma as decimal separator
                                        if (isNaN(value)) value = 'NULL'; // If not a valid number, treat as NULL
                                    }
                                }
                            }
                            // Store the processed value for the current row
                            currentRowValues[fieldName] = value;
                        }
                    }
                    allRowsData.push(currentRowValues);
                }

                // Define the desired order of columns
                const desiredOrder = [
                    'created_at', 'created_by_id', 'updated_at', 'updated_by_id', 'plate', 'park_id',
                    'description', 'expiry_at', 'payment_status', 'phone', 'payment_amount',
                    'name', 'company', 'company_name'
                ];

                // Filter and sort the columns that were actually included based on desired order
                const finalSortedColumns = desiredOrder.filter(col => columnsSet.has(col));

                if (finalSortedColumns.length === 0) {
                    sqlOutput.textContent = "Hiç geçerli alan seçilmedi veya doldurulmadı.";
                    sqlOutput.style.color = '#dc3545';
                    return;
                }

                let allValuesStrings = [];
                allRowsData.forEach(rowData => {
                    const valuesForThisRow = finalSortedColumns.map(col => {
                        // Ensure that if a column is in finalSortedColumns but wasn't in rowData (e.g., checkbox unchecked), it's NULL
                        return rowData[col] !== undefined ? rowData[col] : 'NULL'; 
                    });
                    allValuesStrings.push(`(${valuesForThisRow.join(', ')})`);
                });

                // Construct the final SQL query
                const sql = `INSERT INTO default_parking_whitelist \n\t(${finalSortedColumns.join(', ')})\nVALUES \n\t${allValuesStrings.join(',\n\t')};`;
                
                sqlOutput.textContent = sql;
                sqlOutput.style.color = '#f8f8f2'; // Reset color to code highlight

                // console.log(sql); // For debugging
            });
        });
    </script>

</body>
</html>