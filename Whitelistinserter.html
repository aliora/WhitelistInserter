<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Whitelist Inserter</title>
 <style>
        /* CSS Değişkenleri - Tekrar Eden Değerler */
        :root {
            /* Renkler */
            --bg-primary: #22272e;
            --bg-secondary: #2d333b;
            --bg-tertiary: #1c2128;
            --border-color: #444c56;
            --text-primary: #adbac7;
            --text-secondary: #c9d1d9;
            --text-muted: #8b949e;
            --text-placeholder: #6e7681;
            --accent-blue: #58a6ff;
            --accent-blue-light: #a1cdff;
            --accent-blue-active: #63acff;
            --accent-red: #f85149;
            --accent-orange: #e3b341;
            --shadow-light: rgba(0,0,0,0.2);
            --shadow-medium: rgba(0,0,0,0.3);
            --focus-glow: rgba(88,166,255,0.3);
            
            /* Boyutlar */
            --container-width: 90%;
            --container-max-width: 950px;
            --border-radius: 8px;
            --border-radius-large: 12px;
            --spacing-xs: 5px;
            --spacing-sm: 10px;
            --spacing-md: 15px;
            --spacing-lg: 20px;
            --spacing-xl: 25px;
            --spacing-xxl: 30px;
            
            /* Tipografi */
            --font-primary: 'Inter', sans-serif;
            --font-code: 'Fira Code', 'Consolas', 'Monaco', monospace;
            --font-size-sm: 0.85em;
            --font-size-md: 0.95em;
            --font-size-lg: 1.15em;
            --font-size-xl: 1.2em;
            --font-size-xxl: 2.5em;
            
            /* Geçişler */
            --transition-fast: 0.1s;
            --transition-normal: 0.2s;
            --transition-slow: 0.3s;
        }

        /* Genel Stil ve Koyu Tema Ayarları */
        body {
            font-family: var(--font-primary);
            margin: 0;
            padding: var(--spacing-lg);
            background-color: var(--bg-primary);
            color: var(--text-primary);
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
            box-sizing: border-box;
        }

        h1 {
            color: var(--text-secondary);
            margin-bottom: 35px;
            font-size: var(--font-size-xxl);
            letter-spacing: 1.5px;
            text-shadow: 0 2px 5px var(--shadow-medium);
            text-align: center;
        }

        /* Ortak Konteyner Stilleri */
        .container, #sqlOutputContainer {
            width: var(--container-width);
            max-width: var(--container-max-width);
            background-color: var(--bg-secondary);
            padding: var(--spacing-xxl);
            border-radius: var(--border-radius-large);
            box-shadow: 0 8px 20px var(--shadow-medium);
            border: 1px solid var(--border-color);
        }

        .container {
            margin-bottom: 40px;
        }

        /* Bilgi Notları */
        .info-notes {
            margin-bottom: var(--spacing-xl);
            padding-bottom: var(--spacing-xl);
            border-bottom: 1px solid var(--border-color);
        }
        
        .info-notes p {
            font-size: var(--font-size-md);
            line-height: 1.6;
            margin-bottom: var(--spacing-sm);
        }
        
        .info-notes p:last-child {
            margin-bottom: 0;
        }
        
        .info-notes .red-note {
            color: var(--accent-red);
            font-weight: bold;
        }
        
        .info-notes .orange-note {
            color: var(--accent-orange);
        }

        /* Her Bir Alan Satırı */
        .item-row {
            display: flex;
            align-items: flex-start;
            margin-bottom: var(--spacing-sm);
            padding-bottom: var(--spacing-sm);
            border-bottom: 2px solid #4d94ff;
        }

        
        .item-row:last-of-type {
            border-bottom: none;
            margin-bottom: 0;
            padding-bottom: 0;
        }

        /* Metin Alanı Konteyneri */
        .text-area-container {
            flex-grow: 1;
            display: flex;
            flex-direction: column;
        }

        /* Zorunlu alan başlığı - textarea içinde */
        .required-field-header {
            color: var(--accent-red);
            margin-bottom: 35px;
            margin-top: 35px;
            font-size: var(--font-size-xl);
            letter-spacing: 1.5px;
            text-shadow: 0 2px 5px var(--shadow-medium);
            text-align: center;
            text-transform: uppercase;
        }

        /* Checkbox Konteyneri */
        .checkbox-container {
            margin-right: var(--spacing-lg);
            padding-top: var(--spacing-lg);
            flex-shrink: 0;
        }
        
        .checkbox-container input[type="checkbox"] {
            transform: scale(2);
            accent-color: #3895ff;
            margin-top: 0;
            cursor: pointer;
        }

        /* Kolon Etiket Grubu */
        .column-label-group {
            display: flex;
            flex-direction: column;
            align-items: flex-start;
            min-width: 190px;
            margin-right: var(--spacing-lg);
            flex-shrink: 0;
        }
        
        .column-name {
            font-weight: 600;
            color: var(--text-secondary);
            font-size: var(--font-size-lg);
            margin-bottom: var(--spacing-xs);
        }
        
        .column-description {
            font-size: var(--font-size-sm);
            color: var(--text-muted);
            font-style: normal;
        }

        /* Metin Alanı Konteyneri */
        .text-area-container {
            flex-grow: 1;
            display: flex;
            flex-direction: column;
        }
        
        textarea {
            width: 100%;
            min-height: 100px; /* Yükseklik artırıldı */
            padding: 12px;
            border: 2px solid var(--border-color);
            border-radius: var(--border-radius);
            box-sizing: border-box;
            resize: none; /* Yeniden boyutlandırma kapatıldı */
            font-size: 1em;
            line-height: 1.6;
            background-color: var(--bg-tertiary);
            color: var(--text-primary);
            box-shadow: inset 0 1px 3px var(--shadow-light);
            transition: border-color var(--transition-normal) ease, 
                       box-shadow var(--transition-normal) ease;
        }
        
        textarea::placeholder {
            color: var(--text-placeholder);
        }
        
        textarea:focus {
            outline: none;
            border-color: var(--accent-blue);
            box-shadow: 0 0 0 2px var(--focus-glow);
        }

        /* Hata durumunda textarea kenarlığı */
        textarea.error-border {
            border-color: var(--accent-red) !important;
            box-shadow: 0 0 0 2px rgba(248, 81, 73, 0.5) !important;
        }

        /* Ortak Checkbox Stilleri */
        .now-time-checkbox, .repeat-first-checkbox {
            margin-left: var(--spacing-xl);
            display: flex;
            align-items: center;
            white-space: nowrap;
            flex-shrink: 0;
        }
        
        .now-time-checkbox label, .repeat-first-checkbox label {
            display: flex;
            align-items: center;
            gap: var(--spacing-sm);
            cursor: pointer;
        }
        
        .now-time-checkbox input[type="checkbox"], 
        .repeat-first-checkbox input[type="checkbox"] {
            transform: scale(1.4);
            accent-color: var(--accent-red);
        }
        
.now-time-checkbox span, .repeat-first-checkbox span {
            font-size: var(--font-size-md);
            color: var(--text-primary);
        }

        /* Ortak Buton Stilleri */
        .create-button, #copySqlBtn {
            border: none;
            border-radius: var(--border-radius);
            cursor: pointer;
            font-weight: 600;
            transition: background-color var(--transition-slow) ease, 
                       transform var(--transition-normal) ease, 
                       box-shadow var(--transition-normal) ease;
        }

        /* Ana Buton */
        .create-button {
            padding: 16px 35px;
            font-size: var(--font-size-xl);
            background-color: var(--accent-blue);
            color: white;
            box-shadow: 0 4px 10px #2b517e;
            margin-top: 30px;
            margin-left: 9cm;
        }
        
        .create-button:hover {
            background-color: var(--accent-blue-light);
            transform: translateY(-3px);
            box-shadow: 0 6px 6px var(--accent-blue-active);
        }
        
        .create-button:active {
            transform: translateY(0);
            background-color: var(--accent-blue-active);
            box-shadow: inset 0 2px 4px var(--shadow-medium);
        }

        /* SQL Çıktısı Alanı */
        #sqlOutputContainer {
            margin-top: 40px;
            background-color: var(--bg-tertiary);
            color: var(--text-secondary);
            font-family: var(--font-code);
            font-size: 0.9em;
            white-space: pre-wrap;
            word-break: break-all;
            position: relative;
            min-height: 120px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
        }
        
        #sqlOutput {
            /* max-height: 250px; */ /* Kaldırıldı, içeriğe göre büyüyecek */
            padding-top: var(--spacing-sm);
            width: 100%;
            box-sizing: border-box;
            color: var(--text-muted);
            font-style: italic;
            white-space: pre-wrap;
            overflow-wrap: break-word;
            text-align: left;
            padding-left: var(--spacing-sm);
            /* Çıktı alanının içeriğe göre büyümesini sağlamak için */
            overflow-y: auto; /* İçerik taşarsa kaydırma çubuğu */
            flex-grow: 1; /* Konteynerin içinde esnek büyüme */
        }

        /* Kopyala Butonu */
        #copySqlBtn {
            position: absolute;
            top: var(--spacing-md);
            right: var(--spacing-lg);
            background-color: var(--border-color);
            color: var(--text-secondary);
            padding: 8px 16px;
            font-size: 0.9em;
            z-index: 2;
            box-shadow: 0 2px 5px var(--shadow-light);
        }
        
        #copySqlBtn:hover {
            background-color: #586069;
            transform: translateY(-1px);
        }
        
        #copySqlBtn:active {
            transform: translateY(0);
            background-color: #3b424d;
            box-shadow: inset 0 1px 3px var(--shadow-medium);
        }

        /* Responsive Tasarım */
        @media (max-width: 768px) {
            .container, #sqlOutputContainer {
                width: 95%;
                padding: var(--spacing-lg);
            }
            
            h1 {
                font-size: 2em;
                margin-bottom: var(--spacing-xl);
            }
            
            .item-row {
                flex-direction: column;
                align-items: stretch;
            }
            
            .checkbox-container, .column-label-group, 
            .now-time-checkbox, .repeat-first-checkbox {
                margin-right: 0;
                margin-bottom: var(--spacing-sm);
                width: 100%;
            }
            
            .column-label-group {
                min-width: unset;
            }
            
            .text-area-container {
                margin-bottom: var(--spacing-md);
            }
            
            .now-time-checkbox, .repeat-first-checkbox {
                margin-left: 0;
                justify-content: flex-start;
            }
            
            .create-button {
                width: 100%;
                padding: 14px var(--spacing-lg);
                font-size: 1.1em;
            }

            .platesub {
            color: var(--accent-red);
            margin-bottom: 35px;
            margin-top: 35px;
            font-size: var(--font-size-xl);
            letter-spacing: 1.5px;
            text-shadow: 0 2px 5px var(--shadow-medium);
            text-align: center;
            }
            
            .red-line {
                border: none;
                height: 2px;
                background-color: var(--accent-red);
                margin: 20px 0;
                width: 100%;         /* Tam genişlikte çizgi */
                align-self: stretch; /* Flex konteynerde tam genişlik */
            }


            #copySqlBtn {
                position: static;
                width: 100%;
                margin-top: var(--spacing-md);
                margin-bottom: var(--spacing-sm);
                text-align: center;
            }
            
            #sqlOutput {
                max-height: 180px;
            }

        }
    </style>
</head>
<body>

    <h1 class="platesub">Whitelist Inserter</h1>

<div class="container">
    <div class="info-notes">
        <p class="red-note">Not: Excel'den kopyalanan her satır, sistem tarafından ayrı bir INSERT komutu olarak işlenir. Lütfen verileri satır satır yapıştırınız ve tüm satırların aynı sayıda veri içerdiğinden emin olunuz.</p>
        <p class="orange-note">created_at, created_by_id, park_id, description gibi sabit alanlar tek bir satır olarak girilebilir; bu değerler, diğer tüm verilerle birlikte otomatik olarak her INSERT komutuna dahil edilecektir.</p>
    </div>

        <h4 class="required-field-header">zorunlu alan</h4>

    <!-- ### -->
    <!-- plate alanı -->
    <!-- ### -->
    <div style="display: flex;align-items: flex-start;padding-top: 20px; margin-bottom: 50px;padding-bottom: 20px;border-bottom: 3px solid #ff4d4d;border-top:  3px solid #ff4d4d;">
        <div class="checkbox-container">
            <input type="checkbox" id="plate_check" checked disabled>
        </div>
        <div class="column-label-group">
            <!-- plate alanı -->
            <div class="column-name">plate</div>
            <div class="column-description">(Plaka)</div>
        </div>
        <div class="text-area-container">
            <textarea id="plate_text" placeholder="Örn: 34GTY132"></textarea>
        </div>
    </div>
    <!-- ### -->
    <!-- created_by_id alanı -->
    <!-- ### -->
    <div class="item-row" style="padding-top: 10px; border-top: 2px solid #4d94ff;">
        <div class="checkbox-container">
            <input type="checkbox" id="created_by_id_check" disabled checked>
        </div>
        <div class="column-label-group">
            <!-- created_by_id alanı -->
            <div class="column-name">created_by_id</div>
            <div class="column-description">(Oluşturan kişi ID)</div>
        </div>
        <div class="text-area-container">
            <textarea id="created_by_id_text" placeholder="Örn: 10675"></textarea>
        </div>
        <div class="repeat-first-checkbox">
            <label>
                <input type="checkbox" id="created_by_id_repeat_check" checked>
                <span>İlk Satırı Tekrarla</span>
            </label>
        </div>
    </div>

    <!-- ### -->
    <!-- park_id alanı -->
    <!-- ### -->
    <div class="item-row">
        <div class="checkbox-container">
            <input type="checkbox" id="park_id_check" disabled checked>
        </div>
        <div class="column-label-group">
            <!-- park_id alanı -->
            <div class="column-name">park_id</div>
            <div class="column-description">(Parkın ID'si)</div>
        </div>
        <div class="text-area-container">
            <textarea id="park_id_text" placeholder="Örn: 77"></textarea>
        </div>
        <div class="repeat-first-checkbox">
            <label>
                <input type="checkbox" id="park_id_repeat_check" checked>
                <span>İlk Satırı Tekrarla</span>
            </label>
        </div>
    </div>

    <!-- ### -->
    <!-- created_at alanı -->
    <!-- ### -->
    <div class="item-row">
        <div class="checkbox-container">
            <input type="checkbox" id="created_at_check" disabled checked>
        </div>
        <div class="column-label-group">
            <!-- created_at alanı -->
            <div class="column-name">created_at</div>
            <div class="column-description"></div>
        </div>
        <div class="text-area-container">
            <textarea id="created_at_text" placeholder="YYYY-MM-DD HH:MM:SS formatında giriniz..."></textarea>
        </div>
        <div class="now-time-checkbox">
            <label>
                <input type="checkbox" id="created_at_now_check">
                <span>Şimdiki Zaman</span>
            </label>
        </div>
    </div>

    <!-- ### -->
    <!-- expiry_at alanı -->
    <!-- ### -->
    <div class="item-row">
        <div class="checkbox-container">
            <input type="checkbox" id="expiry_at_check">
        </div>
        <div class="column-label-group">
            <!-- expiry_at alanı -->
            <div class="column-name">expiry_at</div>
            <div class="column-description">(Geçerlilik Tarihi)</div>
        </div>
        <div class="text-area-container">
            <textarea id="expiry_at_text" placeholder="YYYY-MM-DD HH:MM:SS formatında giriniz..."></textarea>
        </div>
        <div class="now-time-checkbox">
            <label>
                <input type="checkbox" id="expiry_at_now_check">
                <span>Şimdiki Zaman</span>
            </label>
        </div>
    </div>

    <!-- ### -->
    <!-- name alanı -->
    <!-- ### -->
    <div class="item-row">
        <div class="checkbox-container">
            <input type="checkbox" id="name_check">
        </div>
        <div class="column-label-group">
            <!-- name alanı -->
            <div class="column-name">name</div>
            <div class="column-description">(Müşteri Adı)</div>
        </div>
        <div class="text-area-container">
            <textarea id="name_text" placeholder="Örn: EMRE"></textarea>
        </div>
        <div class="repeat-first-checkbox">
            <label>
                <input type="checkbox" id="name_repeat_check"> <!-- Varsayılan olarak unchecked -->
                <span>İlk Satırı Tekrarla</span>
            </label>
        </div>
    </div>

    <!-- ### -->
    <!-- company_name alanı -->
    <!-- ### -->
    <div class="item-row">
        <div class="checkbox-container">
            <input type="checkbox" id="company_name_check">
        </div>
        <div class="column-label-group">
            <!-- company_name alanı -->
            <div class="column-name">company_name</div>
            <div class="column-description">(Şirket Adı)</div>
        </div>
        <div class="text-area-container">
            <textarea id="company_name_text" placeholder="Örn: 4B PLAZA"></textarea>
        </div>
        <div class="repeat-first-checkbox">
            <label>
                <input type="checkbox" id="company_name_repeat_check"> <!-- Varsayılan olarak unchecked -->
                <span>İlk Satırı Tekrarla</span>
            </label>
        </div>
    </div>
    <!-- ### -->
    <!-- description alanı -->
    <!-- ### -->

    <div class="item-row">
        <div class="checkbox-container">
            <input type="checkbox" id="description_check">
        </div>
        <div class="column-label-group">
            <!-- description alanı -->
            <div class="column-name">description</div>
            <div class="column-description">(Açıklama)</div>
        </div>
        <div class="text-area-container">
            <textarea id="description_text" placeholder="Örn: Malik"></textarea>
        </div>
        <div class="repeat-first-checkbox">
            <label>
                <input type="checkbox" id="description_repeat_check"> <!-- Varsayılan olarak unchecked -->
                <span>İlk Satırı Tekrarla</span>
            </label>
        </div>
    </div>

    <!-- ### -->
    <!-- payment_status alanı -->
    <!-- ### -->
    <div class="item-row">
        <div class="checkbox-container">
            <input type="checkbox" id="payment_status_check">
        </div>
        <div class="column-label-group">
            <!-- payment_status alanı -->
            <div class="column-name">payment_status</div>
            <div class="column-description">(Ödeme Durumu)</div>
        </div>
        <div class="text-area-container">
            <textarea id="payment_status_text" placeholder="Örn: 1 = Ücretsiz 2 = Ödenmiş 3 = Ödememiş"></textarea>
        </div>
        <div class="repeat-first-checkbox">
            <label>
                <input type="checkbox" id="payment_status_repeat_check"> <!-- Varsayılan olarak unchecked -->
                <span>İlk Satırı Tekrarla</span>
            </label>
        </div>
    </div>

    <!-- ### -->
    <!-- phone alanı -->
    <!-- ### -->
    <div class="item-row">
        <div class="checkbox-container">
            <input type="checkbox" id="phone_check">
        </div>
        <div class="column-label-group">
            <!-- phone alanı -->
            <div class="column-name">phone</div>
            <div class="column-description">(Telefon Numarası)</div>
        </div>
        <div class="text-area-container">
            <textarea id="phone_text" placeholder="Örn: 5551234567"></textarea>
        </div>
        <div class="repeat-first-checkbox">
            <label>
                <input type="checkbox" id="phone_repeat_check"> <!-- Varsayılan olarak unchecked -->
                <span>İlk Satırı Tekrarla</span>
            </label>
        </div>
    </div>

    <!-- ### -->
    <!-- payment_amount alanı -->
    <!-- ### -->
    <div class="item-row">
        <div class="checkbox-container">
            <input type="checkbox" id="payment_amount_check">
        </div>
        <div class="column-label-group">
            <!-- payment_amount alanı -->
            <div class="column-name">payment_amount</div>
            <div class="column-description">(Ödeme Miktarı)</div>
        </div>
        <div class="text-area-container">
            <textarea id="payment_amount_text" placeholder="Örn: 15.75"></textarea>
        </div>
        <div class="repeat-first-checkbox">
            <label>
                <input type="checkbox" id="payment_amount_repeat_check"> <!-- Varsayılan olarak unchecked -->
                <span>İlk Satırı Tekrarla</span>
            </label>
        </div>
    </div>




    <button class="create-button" id="createButton">SQL Sorgusu Oluştur</button>
</div>

<div id="sqlOutputContainer">
    <button id="copySqlBtn" title="Kopyala">Kopyala</button>
    <pre id="sqlOutput">Veri giriniz.</pre>
</div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const createButton = document.getElementById('createButton');
            const sqlOutput = document.getElementById('sqlOutput');
            const copySqlBtn = document.getElementById('copySqlBtn');

            // Kopyala butonu işlevi
            if (copySqlBtn) {
                copySqlBtn.addEventListener('click', () => {
                    const sql = sqlOutput.textContent;
                    if (sql && sql.trim() !== "" && sql !== "Veri giriniz." && !sql.startsWith("Hata:")) {
                        // Geçici bir textarea oluştur
                        const tempTextArea = document.createElement('textarea');
                        tempTextArea.value = sql;
                        document.body.appendChild(tempTextArea);
                        tempTextArea.select(); // Metni seç
                        document.execCommand('copy'); // Kopyala
                        document.body.removeChild(tempTextArea); // Geçici textarea'yı kaldır

                        copySqlBtn.textContent = "Kopyalandı!";
                        setTimeout(() => { copySqlBtn.textContent = "Kopyala"; }, 1200);
                    }
                });
            }

            // Alanların konfigürasyonu ve varsayılan durumları
            const fieldsConfig = {
                created_at: { checkboxId: 'created_at_check', textareaId: 'created_at_text', type: 'datetime', special: 'now_datetime', placeholder: 'YYYY-MM-DD HH:MM:SS formatında giriniz...', mandatory: true },
                created_by_id: { checkboxId: 'created_by_id_check', textareaId: 'created_by_id_text', type: 'int', hasRepeatOption: true, placeholder: 'Örn: 10675', mandatory: true },
                park_id: { checkboxId: 'park_id_check', textareaId: 'park_id_text', type: 'int', hasRepeatOption: true, placeholder: 'Örn: 77', mandatory: true },
                plate: { checkboxId: 'plate_check', textareaId: 'plate_text', type: 'varchar(255)', multiLine: true, placeholder: 'Örn: 34GTY132', mandatory: true }, // Plate her zaman zorunlu ve tikli
                
                // Zorunlu olmayan alanlar (varsayılan olarak unchecked)
                expiry_at: { checkboxId: 'expiry_at_check', textareaId: 'expiry_at_text', type: 'datetime', special: 'now_datetime', placeholder: 'YYYY-MM-DD HH:MM:SS formatında giriniz...', mandatory: false }, 
                name: { checkboxId: 'name_check', textareaId: 'name_text', type: 'varchar(255)', hasRepeatOption: true, placeholder: 'Örn: EMRE', mandatory: false }, 
                company_name: { checkboxId: 'company_name_check', textareaId: 'company_name_text', type: 'varchar(255)', hasRepeatOption: true, placeholder: 'Örn: 4B PLAZA', mandatory: false }, 
                description: { checkboxId: 'description_check', textareaId: 'description_text', type: 'text', hasRepeatOption: true, placeholder: 'Örn: Malik', mandatory: false }, 
                payment_status: { checkboxId: 'payment_status_check', textareaId: 'payment_status_text', type: 'int', hasRepeatOption: true, placeholder: 'Örn: 1 (Ödendi), 0 (Ödenmedi)', mandatory: false }, 
                phone: { checkboxId: 'phone_check', textareaId: 'phone_text', type: 'varchar(255)', hasRepeatOption: true, placeholder: 'Örn: 5551234567', mandatory: false }, 
                payment_amount: { checkboxId: 'payment_amount_check', textareaId: 'payment_amount_text', type: 'double(11,2)', hasRepeatOption: true, placeholder: 'Örn: 15.75', mandatory: false }, 
                
                // Güncel kodda olmayan ancak fieldsConfig'de tanımlı olabilecekler (örnek olarak bırakıldı)
                updated_at: { checkboxId: 'updated_at_check', textareaId: 'updated_at_text', type: 'datetime', special: 'now_datetime', placeholder: 'YYYY-MM-DD HH:MM:SS formatında giriniz...', mandatory: false }, 
                updated_by_id: { checkboxId: 'updated_by_id_check', textareaId: 'updated_by_id_text', type: 'int', hasRepeatOption: true, placeholder: 'Örn: 10675', mandatory: false }, 
                company: { checkboxId: 'company_check', textareaId: 'company_text', type: 'varchar(255)', hasRepeatOption: true, placeholder: 'Örn: A.Ş.', mandatory: false } 
            };

            // HTML'deki checkbox'ların varsayılan durumlarını ayarla
            for (const fieldName in fieldsConfig) {
                const config = fieldsConfig[fieldName];
                const checkbox = document.getElementById(config.checkboxId);
                const repeatCheckbox = config.hasRepeatOption ? document.getElementById(fieldName + '_repeat_check') : null;
                const nowCheckbox = config.special === 'now_datetime' ? document.getElementById(fieldName + '_now_check') : null;

                if (checkbox) {
                    checkbox.checked = config.mandatory; // Zorunlu olanlar checked
                    checkbox.disabled = config.mandatory; // Zorunlu olanlar disabled
                }
                if (repeatCheckbox) {
                    // created_by_id ve park_id için repeat checkbox'ı checked, diğerleri unchecked
                    repeatCheckbox.checked = (fieldName === 'created_by_id' || fieldName === 'park_id');
                }
                if (nowCheckbox) {
                    // created_at için now_check varsayılan olarak unchecked (kullanıcı manuel girecekse)
                    // Diğer tarih alanları için de varsayılan unchecked
                    nowCheckbox.checked = false; 
                }
            }


            // SQL string değerlerini kaçış karakterleriyle düzenleme fonksiyonu
            function escapeSqlString(str) {
                if (typeof str !== 'string') {
                    return str; // String değilse olduğu gibi döndür
                }
                return str.replace(/'/g, "''"); // Tek tırnakları çift tırnak yapar
            }

            // Tarih formatı doğrulama regex'i (YYYY-MM-DD HH:MM:SS)
            const datetimeRegex = /^\d{4}-\d{2}-\d{2} \d{2}:\d{2}:\d{2}$/;

            // Hata mesajını gösteren ve ilgili alana kaydıran yardımcı fonksiyon
            function showErrorAndScroll(message, element) {
                sqlOutput.textContent = `Hata: ${message}`;
                sqlOutput.style.color = 'var(--accent-red)';
                if (element) {
                    element.classList.add('error-border');
                    element.scrollIntoView({ behavior: 'smooth', block: 'center' });
                }
            }

            // Tüm textarea'lardan hata kenarlıklarını temizleyen fonksiyon
            function clearAllErrorBorders() {
                for (const fieldName in fieldsConfig) {
                    const textarea = document.getElementById(fieldsConfig[fieldName].textareaId);
                    if (textarea) {
                        textarea.classList.remove('error-border');
                    }
                }
            }

            createButton.addEventListener('click', () => {
                clearAllErrorBorders(); // Her tıklamada önceki hataları temizle
                sqlOutput.textContent = "Veri giriniz."; // Çıktı alanını sıfırla
                sqlOutput.style.color = 'var(--text-muted)';

                let columnsToInclude = new Set(); // SQL'e dahil edilecek kolonlar
                let allRowsData = []; // Tüm satırlar için veriler
                let plateLines = []; // Plate alanının satırları
                let hasValidationError = false; // Doğrulama hatası olup olmadığını tutar
                let firstErrorElement = null; // İlk hata veren elementi tutar

                // 1. Plate alanı için satır sayısını belirleme (boş satırlar dahil)
                const plateTextarea = document.getElementById(fieldsConfig.plate.textareaId);
                
                // Tüm satırları al, trimle. Sondaki tamamen boş satırları at (kullanıcı fazla enter basmış olabilir)
                // Ayrıca, sadece '-' içeren satırları da boş olarak kabul et.
                let rawPlateLines = plateTextarea.value.split(/\r?\n/).map(line => line.trim()); 
                
                // Sondaki boş veya sadece '-' içeren satırları temizle
                while (rawPlateLines.length > 0 && (rawPlateLines[rawPlateLines.length - 1] === '' || rawPlateLines[rawPlateLines.length - 1] === '-')) {
                    rawPlateLines.pop();
                }

                console.log("Plate Lines (after initial processing):", rawPlateLines); // Debugging line

                if (rawPlateLines.length === 0) {
                    showErrorAndScroll("Plaka alanı zorunludur ve boş bırakılamaz.", plateTextarea);
                    return; // Hata varsa işlemi durdur
                }
                plateLines = rawPlateLines; // Boş olmayan plaka satırlarını al
                const plateLinesCount = plateLines.length;

                // 2. Her bir satır için verileri toplama ve doğrulama
                for (let i = 0; i < plateLinesCount; i++) {
                    let currentRowValues = {}; // Mevcut satır için değerler

                    for (const fieldName in fieldsConfig) {
                        const config = fieldsConfig[fieldName];
                        const checkbox = document.getElementById(config.checkboxId);
                        const textarea = document.getElementById(config.textareaId);
                        const repeatCheckbox = config.hasRepeatOption ? document.getElementById(fieldName + '_repeat_check') : null;
                        const nowCheckbox = config.special === 'now_datetime' ? document.getElementById(fieldName + '_now_check') : null;

                        let valueToProcess = null; // SQL'e eklenecek değer (şimdilik null)
                        let isFieldChecked = checkbox && checkbox.checked;
                        let isMandatory = config.mandatory;
                        let isSpecialOptionChecked = (nowCheckbox && nowCheckbox.checked) || (repeatCheckbox && repeatCheckbox.checked);
                        let isSqlFunction = false; // Bu alanın değeri bir SQL fonksiyonu mu?

                        // Eğer alanın checkbox'ı tikli ise işleme al
                        if (isFieldChecked) {
                            columnsToInclude.add(fieldName); // Kolonu dahil edilecekler listesine ekle

                            // Değeri belirle
                            let currentLineValue = '';
                            if (fieldName === 'plate') {
                                // Plate satırları zaten trimlenmiş ve boş/tire kontrolü yapılmış
                                valueToProcess = plateLines[i]; 
                                if (valueToProcess === '') { // Her bir plaka satırı boş olamaz (tire de dahil)
                                    showErrorAndScroll(`Plaka alanı (satır ${i + 1}) zorunludur ve boş bırakılamaz.`, plateTextarea);
                                    hasValidationError = true;
                                    if (!firstErrorElement) firstErrorElement = plateTextarea;
                                    break; // İç döngüden çık
                                }
                            } else if (isSpecialOptionChecked) {
                                // Özel seçenek (Şimdiki Zaman veya İlk Satırı Tekrarla) işaretliyse
                                if (nowCheckbox && nowCheckbox.checked) {
                                    valueToProcess = 'NOW()';
                                    isSqlFunction = true; // NOW() bir SQL fonksiyonu
                                } else if (repeatCheckbox && repeatCheckbox.checked) {
                                    const firstLineValueRaw = textarea.value.split(/\r?\n/)[0]?.trim() || '';
                                    const firstLineValue = (firstLineValueRaw === '' || firstLineValueRaw === '-') ? '' : firstLineValueRaw; // İlk satır boş veya '-' ise boş kabul et
                                    
                                    if (firstLineValue === '') { // Tekrarlanan ilk satır boşsa hata ver
                                        showErrorAndScroll(`${config.placeholder.split(':')[0]} alanı için 'İlk Satırı Tekrarla' seçeneği işaretli ancak ilk satır boş bırakılamaz.`, textarea);
                                        hasValidationError = true;
                                        if (!firstErrorElement) firstErrorElement = textarea;
                                        break; // İç döngüden çık
                                    }
                                    valueToProcess = firstLineValue;
                                }
                            } else {
                                // Normal textarea girişi
                                const allLines = textarea.value.split(/\r?\n/).map(line => line.trim());
                                let effectiveValueForThisRow = '';

                                if (allLines.length === 1) {
                                    // Eğer tek satır girilmişse, bu değeri tüm satırlar için kullan
                                    effectiveValueForThisRow = allLines[0];
                                } else if (allLines.length > 1 && allLines.length !== plateLinesCount) {
                                    // Eğer birden fazla satır girilmişse ve plaka satır sayısıyla eşleşmiyorsa hata ver
                                    showErrorAndScroll(`${config.placeholder.split(':')[0]} alanı için girilen satır sayısı (${allLines.length}), plaka satır sayısı (${plateLinesCount}) ile eşleşmiyor.`, textarea);
                                    hasValidationError = true;
                                    if (!firstErrorElement) firstErrorElement = textarea;
                                    break; // İç döngüden çık
                                } else { // allLines.length > 1 && allLines.length === plateLinesCount
                                    // Eğer birden fazla satır girilmişse ve eşleşiyorsa, ilgili satırı kullan
                                    effectiveValueForThisRow = allLines[i] || '';
                                }

                                // Eğer satır sadece '-' ise veya boşsa, boş olarak kabul et
                                if (effectiveValueForThisRow === '-' || effectiveValueForThisRow === '') {
                                    effectiveValueForThisRow = '';
                                }

                                // created_at özel durumu: Şimdiki Zaman tikli değilse ve boşsa hata ver
                                if (fieldName === 'created_at' && !nowCheckbox.checked && effectiveValueForThisRow === '') {
                                    showErrorAndScroll(`${config.placeholder.split(':')[0]} alanı zorunludur ve boş bırakılamaz.`, textarea);
                                    hasValidationError = true;
                                    if (!firstErrorElement) firstErrorElement = textarea;
                                    break;
                                }
                                // Tarih alanları için "limitsiz" kontrolü
                                else if (config.type === 'datetime' && effectiveValueForThisRow.toLowerCase() === 'limitsiz') {
                                    valueToProcess = 'NULL'; // "limitsiz" ise NULL olarak ayarla
                                } 
                                // Zorunlu alanlar için boşluk kontrolü (plate ve created_at dışındaki zorunlular)
                                else if (isMandatory && effectiveValueForThisRow === '') {
                                    showErrorAndScroll(`${config.placeholder.split(':')[0]} alanı zorunludur ve boş bırakılamaz.`, textarea);
                                    hasValidationError = true;
                                    if (!firstErrorElement) firstErrorElement = textarea;
                                    break;
                                }
                                // Zorunlu olmayan alanlar için boşluk kontrolü (NULL olarak geçecek)
                                else if (!isMandatory && effectiveValueForThisRow === '') {
                                    valueToProcess = 'NULL'; // Hata verme, NULL olarak işle
                                }
                                else {
                                    valueToProcess = effectiveValueForThisRow;
                                }
                            }

                            // Hata yoksa kenarlığı temizle
                            if (textarea) {
                                textarea.classList.remove('error-border');
                            }

                            // description alanı için özel işlem (burada valueToProcess zaten belirlenmiş olmalı)
                            if (fieldName === 'description' && isFieldChecked) {
                                if (valueToProcess === 'NULL' || valueToProcess === '') { // If it was determined as NULL or empty
                                    valueToProcess = `DATE_FORMAT(NOW(), '%Y-%m-%d')`;
                                } else {
                                    valueToProcess = `CONCAT('${escapeSqlString(valueToProcess)} ', DATE_FORMAT(NOW(), '%Y-%m-%d'))`;
                                }
                                isSqlFunction = true; // description için bu özel durum bir SQL fonksiyonu olarak işaretlenmeli
                            }

                            // SQL formatlaması
                            // Eğer değer bir SQL fonksiyonu ise tırnak içine alma
                            if (!isSqlFunction) { 
                                if (valueToProcess === 'NULL') { // Zaten NULL olarak ayarlandıysa tırnak ekleme
                                    // Do nothing, already 'NULL'
                                }
                                else if (config.type.startsWith('varchar') || config.type === 'text' || config.type === 'datetime') {
                                    valueToProcess = `'${escapeSqlString(valueToProcess)}'`;
                                } else if (config.type.startsWith('int')) {
                                    valueToProcess = parseInt(valueToProcess, 10);
                                    if (isNaN(valueToProcess)) valueToProcess = 'NULL';
                                } else if (config.type.startsWith('double')) {
                                    valueToProcess = parseFloat(valueToProcess.replace(',', '.'));
                                    if (isNaN(valueToProcess)) valueToProcess = 'NULL';
                                }
                            }
                            currentRowValues[fieldName] = valueToProcess;
                        } else {
                            // Checkbox tikli değilse, bu kolonu dahil etme (columnsToInclude'a eklenmediği için otomatik olarak hariç kalır)
                            if (textarea) {
                                textarea.classList.remove('error-border'); // Tikli değilse hata kenarlığını temizle
                            }
                        }
                    } // fieldName döngüsü sonu

                    if (hasValidationError) {
                        break; // Dış döngüden de çık
                    }
                    allRowsData.push(currentRowValues);
                } // plateLinesCount döngüsü sonu

                // Genel doğrulama hatası varsa işlemi durdur
                if (hasValidationError) {
                    return;
                }

                // Kolonların SQL sorgusundaki sırasını belirle
                const desiredOrder = [
                    'created_at', 'created_by_id', 'updated_at', 'updated_by_id', 'plate', 'park_id',
                    'description', 'expiry_at', 'payment_status', 'phone', 'payment_amount',
                    'name', 'company', 'company_name'
                ];

                // Sadece dahil edilecek kolonları ve istenen sıraya göre filtrele
                const finalSortedColumns = desiredOrder.filter(col => columnsToInclude.has(col));

                if (finalSortedColumns.length === 0) {
                    showErrorAndScroll("Oluşturulacak geçerli bir alan bulunamadı. Lütfen en az bir alan seçin ve doldurun.", null);
                    return;
                }

                // Her satır için değer stringlerini oluştur
                let allValuesStrings = [];
                allRowsData.forEach(rowData => {
                    const valuesForThisRow = finalSortedColumns.map(col => {
                        // Eğer kolon bu satırda tanımlı değilse (örneğin checkbox tikli değilse), NULL olarak ayarla
                        return rowData[col] !== undefined ? rowData[col] : 'NULL'; 
                    });
                    allValuesStrings.push(`(${valuesForThisRow.join(', ')})`);
                });

                // Nihai SQL sorgusunu oluştur
                const sql = `INSERT INTO default_parking_whitelist\n\t(${finalSortedColumns.join(', ')})\nVALUES\n\t${allValuesStrings.join(',\n\t')};`;
                
                sqlOutput.textContent = sql;
                sqlOutput.style.color = 'var(--text-secondary)'; // Başarılı çıktı rengi
            });
        });
    </script>

</body>
</html>